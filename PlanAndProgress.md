# Orbuculum of Legends

> 魔球奇谭

这是 MARYT 11th 整合包的发布标题。

## 背景故事

很久很久以前，一个不知名的小村庄，住着一位心灵手巧的工匠。

在冬季的某一天，这位工匠完成了他的新作品：一个精巧的水晶球。

球中布置着他的小屋和周边景物的微缩模型，和不会融化的雪；

只要轻轻转动，雪就会纷纷扬扬地落下，落在小屋的屋檐和小树的树梢上。

工匠高兴极了，赶紧烧旺壁炉的火、摆下一桌宴席，

邀请他的七位魔法师朋友，和他一起庆祝这件作品的完工。

第一位魔法师来了。他施展法术，祝福球中的世界气候温和，适宜万物生长；

第二位魔法师来了。他在球中的世界布置了生机勃勃的雨林；

第三位魔法师来了。他随手抓起地上的沙子，便化作了神秘的沙漠；

第四位魔法师喜爱广阔的大海，于是给球中的世界赠予了海洋；

第五位魔法师让牛羊动物遍布大地，水晶球中隐约可以听到咩咩哞哞的声音；

第六位魔法师构造了灼热的地心，赋予了世界运行的动力。

在欢乐的氛围当中，大家坐下来开怀畅饮，全然忘记了还有一位朋友姗姗来迟。

第七位魔法师到来之时，桌上已经剩下残羹冷炙，大家面面相觑，不知道该说些什么。

“好啊！你们吃饭不等我！”显然，他十分生气，

“我把你们全部封进这个球里，一辈子别想出去！”

...

工匠醒来了，在一个陌生的世界里。

他举目四望，意识到自己真的被装进了水晶球中，那个刚刚成形的世界。

“现在我该怎么办？”

“不管怎么样，我得想办法离开这里。”

从不知道什么地方，隐隐有声音传来：

“我们会一起帮助你出去。”

## 整合包设计思路

这个整合包分为八个阶段，前 7 个阶段对应背景故事中的一位魔法师，共有 7 个 BOSS 和 7 个维度；

第 8 阶段没有实际游戏内容，为 ENDGAME 阶段。

以 FTB 任务线贯穿整个流程，以 7 个 BOSS 生物的攻略为明线，食物的收集为暗线，双线开展。

玩家需要依次经过

1. 以种植原版作物为主的“主世界” - 阿波罗（Apollo）- 维度 ID `orbuculum_of_legends:fake_overworld`
2. 热带世界 - 鳕鱼（Codusk）- 维度 ID `tropicraft:tropics`
3. 以种植沙漠作物为主的沙漠世界 - 沙图恩（Saturn）- 维度 ID `orbuculum_of_legends:desert`
4. 以钓鱼和养鱼为主的海洋世界 - 尼奥尔德（Nyord）- 维度 ID `orbuculum_of_legends:ocean`
5. 无法种植作物，只能狩猎与游牧的世界 - 腾格里（Tangri）- 维度 ID `orbuculum_of_legends:wild`
6. 地狱 - 祝融（Zhurong）- 维度 ID `minecraft:the_nether`
7. 末地 - 印和阗（Imhotep）- 维度 ID `minecraft:the_end`

共七个维度，

加上 ENDGAME 阶段的主世界，共有 8 个维度，每个维度对应一个游戏阶段，每个阶段对应若干个食物模组。

每个阶段的末尾，玩家需要以该阶段的最高级食物为祭品，召唤该阶段的 BOSS 并将其击败，才能进入下一阶段，

进入下一阶段后，玩家不能再返回上一个阶段的世界。

玩家需要在阶段末尾制作末影箱，放入要带走的27组物品，加上背包的36格空间和1格副手，总共可以携带64组物品和4件盔甲。

进入下一阶段时，游戏会给玩家赠送一个新末影箱，玩家即可从中取出27组物品。

在进入狩猎与游牧世界之前，玩家不能制作德鲁伊mod的旅行包。在进入 ENDGAME 阶段之前，玩家无法制作潜影盒。

召唤第七阶段的 BOSS 并击败之，则玩家进入 ENDGAME 阶段的主世界维度，整合包通关，

此时玩家获得自由来往于各个阶段维度的能力，作为整合包最终通关奖励。

## 整合包特色机制

### BOSS 与“打 BOSS 模式”

在 BOSS 被召唤出来后、玩家死亡之前，玩家会处于打BOSS模式。

该模式下，玩家吃下食物将获得与食物本身的价值相对应的属性增益，包括伤害减免、伤害增加、生命回复等等。

此外，玩家如果在吃下指定种类的食物时注视 BOSS，可以对 BOSS 施加特定种类的影响。

但一旦玩家在该模式下死亡，BOSS将被游戏杀死且不掉落任何奖励，玩家也会退出打BOSS模式，之前获得的属性增益均归零。

打 BOSS 模式下的特性食物有且只有五个：

高饱和大回血（CD长）

低饱和小回血（主要血药）

低饱和小 Buff（主要 Buff 药）

高饱和大 Buff（CD长）

技能食物（Spellbind）

在打 BOSS 模式下受伤会随机扣减饱和度，以便缩短食物的冷却时间。

带有 `BossMob` 标签的 BOSS 和带有 `BossFollower` 标签的 BOSS 召唤的怪物都不会掉落任何物品。

已在一阶段 BOSS 脚本中实现，无需重复实现。

### 治疗机制

将游戏规则 `naturalRegeneration` 设为 `false`，玩家在整个游戏流程中，其饥饿度和饱和度都不能产生自然回血的效果。

玩家需要收集特定的道具来恢复体力，此外在打 BOSS 模式下一些食物也会产生恢复体力的效果。

________________

## 生存测试笔记

### 第一阶段

#### 可以获得的资源

##### 有用的资源

木头石头铁。

##### 没有用的资源

DruidCraft 的接骨木浆果只能吃、热带世界的 **椰子和菠萝** 甚至不能吃、

DruidCraft 的琥珀、岩化根、烈焰玻璃（只能当柴烧），VFP 的岩盐、碳酸钠，

简单的茶的小冰块、碧海新生的包埋鹦鹉螺的石头（只能烧成前期没啥用的鹦鹉螺）。

*W Collection 模组有一个生锈的铁，其特性有待观察。*

怪物掉落物方面主要为 Dannys Expansion 的怪物掉落物，

包括史莱姆掉落的蓝色粘液、食尸鬼掉落的内脏精华、灵魂铠甲掉落的盔甲碎片等。

~~*Danny Collection 模组有个自己的工作台，以及一系列自定义的武器装备，这些东西的特性有待观察。不排除这些看起来没有用的材料和看起来无法获得的武器装备是通过那个工作台的合成联系起来的。*~~ （该工作台已经确认需要删除。）

#### 野生农作物的生成

在 fake_overworld 中，已经确定 DruidCraft 的接骨木会自然生成，

但是数量太少，不太能满足要求；且即使玩家跳过接骨木的合成任务，直接获取接骨木及其产品，

对游戏进度的影响也不太大。

黑木完全不会生成。

~~农夫乐事的野生作物会否生成待定。若不生成，应设法取代之。~~ 农夫乐事的野生作物确定会生成。

SimplyTea 和 Tea Kettle 的茶树应当认为不会生成，需要添加合成。

*可以考虑将茶移动到二阶段。*

#### 主要的威胁

Dannys Expansion 的敌对生物

#### 考虑的调整方案

- [x] 禁止 Dannys Expansion 的生物在第一阶段的世界生成。（现已完全不会生成，无需再写 ZC 脚本。）
- [x] 增加琥珀与岩化根的实际用途。
- [x] ~~考察 Dannys Expansion 的工作台。~~ Dannys Expansion 的工作台的确可以合成一些东西，但是它包含一部分无用物品的合成且不能删除。仍需另外魔改这些物品的配方，同时删除工作台本身的合成。
- [x] 将黑木移动到二阶段。
- [x] 将接骨木移动到二阶段。

## 魔改规划

### 脚本优先级规定

9000：有创造物品栏标签的 ContentTweaker 脚本
  - 全阶段通用脚本
    1. `ContentTweaker_MedicalStuffs.zs`
  - 一阶段脚本
    
    暂无
  - 二阶段脚本
    1. `ContentTweaker_Feadog.zs`
8500：其他 ContentTweaker 脚本

### 与阶段无关的规划内容

- [x] DruidCraft 镰刀的新功能：破坏草和作物时，将附近的草掉落物和作物掉落物 ~~拉到使用者身边~~ 吸入使用者的背包。
- [x] 马鞍和皮革马铠均可用皮革或布头、棕色地毯（可可豆），以及锁链合成。
- [x] 布头可以代替皮革合成皮革盔甲。尽管这样做可以让布头通过农夫乐事的砧板转化为皮革，但考虑到皮革的实际价值与布头差不多，这种转化可以允许。
- [x] 锁链可以与布头/皮革一起合成锁链甲。
- [x] 修改 DruidCraft 的生长灯配方。

### 第一阶段魔改规划

- [x] ~~删除主世界中原版红石、青金石、钻石的生成、DruidCraft 月光石、碧海新生包含鹦鹉螺的石头的生成，~~ 重新构造一个只生成煤、铁、~~金、~~（第一阶段用不到，故删除）琥珀、岩化根、烈焰玻璃、岩盐、碳酸钠的世界。目前的方案为，煤矿脉中，煤、烈焰玻璃、铁以7:2:1比例伴生；铁矿脉中，铁、煤以7:3比例伴生；化石矿脉中，岩化根、琥珀、骨块以3:3:1比例伴生。~~盐矿脉中，岩盐、碳酸钠以1:1比例伴生~~（**整个 VFP 中盐和干燥食物的内容移动到狩猎世界，与食物腐败机制关联**）
- [x] 检查 ~~农夫乐事的野菜、~~ （已确认会生成）~~简单茶树的茶树是否生成。~~ 不会生成。**将茶相关内容移动到二阶段**。
- [x] 允许玩家制作便携工作台。
- [x] 岩化根和琥珀可以制作和修复矿物探测器和金属探测器和群系指南针。
- [x] 探测器和群系指南针应有说明文字。
- [x] ~~给草方块和草添加掉落物“苔藓团”。~~ 已添加。该物品直接右键使用，0.1 概率恢复 4 心，0.3 概率恢复 2 心，期望为恢复 1 心。
- [x] ~~苔藓团可以与（某物品）合成“简易创可贴”，~~ 已添加。该物品直接右键使用，0.3 概率恢复 3 心，0.6 概率恢复 1 心，期望为恢复 1.5 心。
- [x] ~~确定上一条中的“某物品”~~ 确定为 DruidCraft 的线麻合成的物品“布头”。
- [x] 玩家可以用箱子和末影珍珠合成末影箱。
- [x] 末影箱被没有精准采集的工具破坏时，改为掉落箱子物品。
- [x] 除 4 合 1 合成大份熔岩沙外，所有熔岩沙参与的合成均需删除。

### 第一阶段 Boss

- [x] 将祭品丢在三格内的地上，用信物召唤。召唤时消耗祭品和信物。
- [x] 召唤仪式会将玩家提高到 160 格，并加缓降效果使玩家安全落地。

具体特性参阅下文 BOSS 设定表。

#### 打 BOSS 模式特性食物

- [x] 高饱和大回血（CD长）：肉汤 - 烹饪锅 原效果：立即回复 4 颗心，改为：立即回复 9 颗心
- [x] 低饱和小回血（主要血药）：混合沙拉 - 农夫乐事 原效果：立即回复 1 颗心，改为：增加 75 秒饥饿 V，立即回复 4 颗心，缓慢回复生命 20 秒钟
- [x] 低饱和小 Buff（主要 Buff 药）：卷心菜卷 - 农夫乐事 原本没有效果，改为：增加 45 秒饥饿 VI，45 秒跳跃提升 III，45 秒速度 I
- [x] 高饱和大 Buff（CD长）：莎莎酱 - 烹饪锅 保留急迫 6 分钟效果，10 秒力量 I，45 秒跳跃提升 VI，1 分钟速度 I，1 分钟夜视
- [x] 技能食物（Spellbind）：金胡萝卜 - 原版，使 Boss 发光 25 秒钟

### 第二阶段

~~将写好的feature加入数据包中，添加方法参考heaven 1.16数据包~~

暂时采用 RandomWorldGen 定制模组代替数据包方案。

- [x] 黑木应在此阶段加入游戏

  黑木生成的群系为四种雨林群系：
  - rainforest_hills
  - rainforest_island_mountains
  - rainforest_mountains
  - rainforest_plains
- [x] 接骨木应在此阶段加入游戏
  
  接骨木生成的群系为四种雨林群系：
  - rainforest_hills
  - rainforest_island_mountains
  - rainforest_mountains
  - rainforest_plains

  接骨木生成的群系与黑木相同
- [x] 所有的茶树在此阶段加入游戏
  
  茶树生成的群系为上面的四种雨林群系与竹林雨林 `z_bamboo_rainforest` 群系
- [ ] 尽量使两种茶可以通用，或用一种取代另一种
- [x] 红石、煤炭和石英伴生的矿脉
- [x] 青金石、石英伴生的矿脉
- [x] 检查石英的所有用途，~~将其中不合理的删除~~ 石英可以在村民处换绿宝石，除此之外没有不合理用途。村民交易已经作为通关后限定内容。
- [ ] 增加热带世界矿石的用途
  - 热带世界的矿石有 5 种：
    - 石青 -> 石青（潜水服、饮料机、海洋权杖）
    - 异性石 -> 异性石（只能做工具）
    - 沙响石 -> 沙响石（缺少用途）-> **用于制作附魔台**
    - 锰 -> 锰锭（缺少用途）-> 改名为“猛”，**用于制作通关道具**
    - 锆 -> 锆石（工具、潜水服、吹筒）、锆晶体（只能做工具）
  
- [ ] 附魔台在此阶段加入游戏，不用钻石和黑曜石合成，钻石用青金石代替，黑曜石 ~~需要另找方块~~ 用沙响石块代替
- [ ] 面具与饮料配方挂钩的机制：9 种饮料饮料分三组，13 种面具分成 4 4 5 三组，必须佩戴面具询问饮料机饮料配方，饮料机才能合成相应的饮料
- [ ] 删除所有热带世界饮料的工作台配方
- [x] 删除热带世界原有的所有矿脉
- [x] 删除热带世界的矿井、村庄
- [ ] 筛子和筛子的产物需要利用起来：特殊用途只使用了其中的黑珍珠，其余的都可以做骨粉，并加 Tooltip 提示。

#### 本阶段剧情设计相关魔改规划

1. [ ] 第二章最初的任务中，鳕鱼自我介绍自己是椰术师，引起主角的好奇，但鳕鱼拒绝进一步的回答，给了玩家一把哨笛（哨笛用盖尔语名字 Feadog 命名，它可以在任务中重复领取）。
2. [ ] 鳕鱼引导主角去收集一些椰，通过吹响哨笛交给自己，无意间说出哨笛、椰术与传递物品之间的关系。
3. [ ] 这个任务是主角的内心活动。主角隐约感觉到鳕鱼需要一些能安抚情绪的东西。主角以“带一些见面的礼物”为理由，吹响哨笛给鳕鱼送去了茶。
4. [ ] 鳕鱼逐步介绍椰术和自己的关系。
   
   > 鳕鱼是从另一个宇宙被召唤而来的。在他原来所处的宇宙中，鳕鱼是一位部落酋长，有一群和谐友爱的子民。
   > 但某一天，鳕鱼的部落受到了狗缺乏症感染者的侵扰。狗缺乏症是一种传染性疾病，感染者如果没有与狗狗接触就会发病。其余设定与原设定一致。
   > 很快整个部落都感染了狗缺乏症，因狗缺乏症晚期而发狂的患者对他人充满敌意，甚至对亲人和朋友无差别地攻击。部落已经不再是过去的样子。
   > 然而，包括鳕鱼自己也感染了狗缺乏症。鳕鱼为了稳定自己的病情、保持理智，不得已阅读了部落秘传的魔法禁书，希望找到救命稻草。
   > 鳕鱼是一个魔法天才，很快学会了禁书中记载的咒语和法术，并用来缓和自己和部落子民的病情。法术需要椰作为触媒，因此被称为“椰术”。
   > 然而，随着施法越来越多，鳕鱼日渐虚弱，只能够勉强维持自己的理智。最终，部落没能摆脱全部进入狗缺乏症晚期的命运。
   > 为了阻止这些充满攻击性的部落子民继续在无谓的打斗中丧生，鳕鱼按照禁书最后一页的指引，向“不知名的神明”祈祷，
   > 希望后者为部落创造一个没有敌人的安全环境，让他们能够度过余生。
   > 于是“不知名的神明”将鳕鱼和整个部落召唤到现在所处的宇宙，并向鳕鱼启示了能够创造世界的终极椰术。
   > 鳕鱼穷尽最后一点体力施放了这个椰术，创造了热带世界，将部落子民全部放在里面，他们化为了灰烬武士。
   > 虚弱的鳕鱼被其余六位魔法师所搭救，他们因为这样的契机而结识，成为了朋友。

   - [ ] 任务需要给予“病理笔记”道具，由原版 Minecraft 成书实现，内容是展示狗缺乏症的原设定。
   - [ ] 灰烬武士失去面具后，玩家和武士无法互相攻击。
5. [ ] “不知名的神明”引导主角发现热带世界有一些植物可以制作成酒，并让主角喝喝看。在酒后的幻觉中，“不知名的神明”启示主角，喝酒会让人说真话，不如找鳕鱼喝两杯。
6. [ ] 主角通过哨笛向鳕鱼传递了酒。在喝酒聊天的过程中，主角询问鳕鱼为什么遭到朋友的如此对待，被封印在水晶球里。
   
   > 鳕鱼尽管与六位魔法师朋友认识，但不愿向朋友们坦承自己的过去，在聚会时总是沉默寡言，尽量避免和朋友们说话。
   > 这引起了印和阗的注意。印和阗是黑魔法师，一直怀疑原先的五位朋友因此而看不起他、在暗中排挤他。他以为鳕鱼也是一位和他一样的黑魔法师。
   > 而鳕鱼那本从来不让朋友们翻看的禁书，则让印和阗更加确信自己的判断。
   > 印和阗把鳕鱼当成了唯一的救命稻草。他觉得，只要确定了鳕鱼也是一个黑魔法师，鳕鱼就可以是自己唯一值得信赖的朋友。
   > 所以，他认为自己应该先看到那本禁书究竟是什么书。于是他三番五次地去找鳕鱼借这本书，但总是遭到鳕鱼的拒绝，于是印和阗因此而记恨鳕鱼。
   > 但鳕鱼也不知道，如果印和阗只是记恨自己的话，他为什么要一次和六个朋友翻脸。
   
   - [ ] 这个过程需要传递三次酒，每次需要一种分组下的酒。相同分组的酒可以平替。
7. [ ] 主角告诉鳕鱼自己理解了对方的苦衷，希望大家齐心协力，一起逃出水晶球。并向鳕鱼说“不用害怕把你的故事告诉别人，要相信你的朋友能够倾听和理解，比如我”。
8. [ ] 鳕鱼深受感动，终于向主角敞开心扉。鳕鱼教给了主角一些椰术，并指引了主角如何召唤和战胜第二层的守关凶兽。
   - [ ] 第二层的守关凶兽同样患有狗缺乏症，因此狗是它的弱点。
   - [ ] 需要猛锭制成的椰术道具“猛狗脱缰”，才能对第二层的守关凶兽完成致命一击。

### 第三阶段

- [ ] 金在此阶段加入游戏。
- [ ] 钻石在此阶段加入游戏。
- [ ] 月长石在此阶段加入游戏。

### 第四阶段

- [x] 只有已经通关第三层的玩家可以放置、破坏和交互渔栅，未通关第三层的玩家不能
- [x] 只有在第四层世界内允许放置、破坏和破坏渔栅，其他世界内不能
- [x] ~~渔栅在第四层世界以外，不与漏斗等方块交互~~ 试过了，做不到
- [ ] 钓鱼的战利品表在第四层以外世界均限制为鱼类

### 第五阶段

- [x] 所有需要盐和碳酸钠合成的物品都加上 tooltip 以示提醒。
- [x] 玩家在通关第四层之前，无法使用所有 VFP 模组的牛奶制品，同时加上 tooltip 以示提醒。
- [ ] 便携末影箱应在此阶段允许使用，并设置相应任务。
- [ ] DruidCraft 背包应在此阶段允许合成，并设置相应任务。在此之前不允许玩家使用，并加上 tooltip 以示提醒。

### 第六阶段
- [ ] 锈铁武器和装备在此阶段加入游戏。在此之前不允许玩家使用，加上 tooltip 以示提醒。

### 第七阶段
- [ ] WilesCollection 的箱子、液体桶和工作台在此阶段加入游戏，在此之前不允许玩家使用，加上 tooltip 以示提醒。
- [ ] 潜影盒在此阶段加入游戏，在此之前不允许玩家使用，加上 tooltip 以示提醒。

### 通关阶段
- [x] 仅允许村民和流浪商人在此维度内与玩家交互
- [x] 仅在此维度内，僵尸村民可以吃金苹果

## 整合包相关的技术问题

1. ~~本整合包与 JustEnoughCharacters（通用拼音搜索）不兼容，原因不明。~~ 无法复现，该问题已排除。

## 附件：BOSS 设定表

### 一阶BOSS

生物原型：~~原版幻翼~~ 原版持弓凋灵骷髅

属性：

- [x] 生命值 120，
- [x] 受到大于 10 点的伤害会被限制到 10。
- [x] 本体体积会被 ~~放大为原来的 2.2 倍~~ 缩小为原来的 0.7 倍，使其和玩家身材相当。
- [x] 本体的速度为原来的 3.3 倍。
- [x] 分身的体积为原来的 ~~1.3~~ 0.9 倍，速度为 3.2 倍。
- [x] 分身空手，不拿武器。
- [x] 一旦召唤者死亡，本体和分身也都会一起消失。

有可能可以将最后一条技能用 [MCServerWorld#getEntities](https://docs.blamejared.com/1.16/en/vanilla/api/world/MCServerWorld#getEntities) 重构。

参考命令：

`/summon minecraft:wither_skeleton ~ ~10 ~ {"pehkui:scale_data_types":{"pehkui:width":{"initial":3.0,"scale":3.0,"target":3.0},"pehkui:height":{"initial":3.0,"scale":3.0,"target":3.0}}}`

技能：

1. [x] 每次攻击玩家时，若以自身为中心，半径 5 的正方体空间内分身数量不大于 2，有 50% 概率召唤 X 个血量较低的分身（X 介于 1-4，从 1-4 触发概率之比为4：3：2：1，分身的血量之和为 36，若本体血量少于 60，则分身的血量之和为 24），然后使自己隐身 (10X-5，若本体血量小于 60，则改为 8X-4) 秒钟。
2. [x] 每次被玩家攻击时，有概率隐身 5 秒钟。
3. [x] 本体攻击非召唤者的生物没有伤害，非召唤者的生物攻击本体没有伤害。
4. [x] 玩家吃下 ~~某种指定食物~~ 已确定为金胡萝卜，可以使其发光 25 秒钟。
5. [x] 烧火棍儿能对其造成额外的伤害。

名字：魅 (The Confuser)

称号：阴影中的封印守卫者 (Seal Guardian Hidden in Shadow)

台词：

- [x]  出场：我是魅，阴影中的封印守卫者，守卫第一道封印。请在无尽的幻影之中找出我并击败我吧。
- [x]  技能1：不要在没有光的地方寻找影子。/我是光的反面，与光相伴而生。
- [x]  技能2：不要试图追逐我的踪迹。/你抓不住我的，但我可以抓住你。
- [x]  生命值低于 60：我感到我的力量正在被驱散...
- [x]  提示语：它的分身法术变弱了，快乘胜追击！
- [x]  召唤者被击败：重新召唤我吧，我会再给你机会。
- [x]  送别：你终于还是突破了第一道封印。不要太得意了，前面还有更强大的封印守卫者在等待你呢。
